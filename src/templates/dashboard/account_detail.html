{% extends "base.html" %}

{% block title %}{{ account.email }} - Calendar Sync Tool{% endblock %}

{% block content %}
<div class="card">
    <h2>Account: {{ account.email }}</h2>
    <p>Detailed view of calendar account and synchronization settings.</p>
    <a href="{% url 'dashboard:index' %}" class="btn">‚Üê Back to Dashboard</a>
</div>

<!-- Account Information -->
<div class="card" role="region" aria-labelledby="account-info-heading">
    <h3 id="account-info-heading">Account Information</h3>
    <table role="table" aria-label="Google Calendar account details">
        <tr>
            <td><strong>Email:</strong></td>
            <td>{{ account.email }}</td>
        </tr>
        <tr>
            <td><strong>Status:</strong></td>
            <td>
                {% if account.is_active %}
                    <span class="status status-active">Active</span>
                {% else %}
                    <span class="status status-inactive">Inactive</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <td><strong>Connected:</strong></td>
            <td>{{ account.created_at|date:"M d, Y H:i" }}</td>
        </tr>
        <tr>
            <td><strong>Last Sync:</strong></td>
            <td>
                {% if account.last_sync %}
                    {{ account.last_sync|date:"M d, Y H:i" }}
                {% else %}
                    Never
                {% endif %}
            </td>
        </tr>
        <tr>
            <td><strong>Token Expires:</strong></td>
            <td>
                {% if account.token_expires_at %}
                    {{ account.token_expires_at|date:"M d, Y H:i" }}
                {% else %}
                    Unknown
                {% endif %}
            </td>
        </tr>
    </table>
</div>

<!-- Calendars -->
<div class="card" role="region" aria-labelledby="calendars-heading">
    <h3 id="calendars-heading">Calendars ({{ calendars.count }})</h3>
    {% if calendars %}
        <table role="table" aria-label="Calendar synchronization settings">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Google ID</th>
                    <th>Sync Enabled</th>
                    <th>Primary</th>
                    <th>Color</th>
                </tr>
            </thead>
            <tbody>
                {% for calendar in calendars %}
                <tr>
                    <td>{{ calendar.name }}</td>
                    <td><code>{{ calendar.google_calendar_id }}</code></td>
                    <td>
                        {% include 'dashboard/partials/calendar_sync_status.html' %}
                    </td>
                    <td>
                        {% if calendar.is_primary %}
                            <span class="status status-active">Yes</span>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if calendar.color %}
                            <span class="calendar-color-badge" data-color="{{ calendar.color }}" aria-label="Calendar color: {{ calendar.color }}">{{ calendar.color }}</span>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No calendars found for this account.</p>
    {% endif %}
</div>

<!-- Sync History -->
{% if sync_logs %}
<div class="card" role="region" aria-labelledby="sync-history-heading">
    <h3 id="sync-history-heading">Sync History (Last 20)</h3>
    <table role="table" aria-label="Calendar synchronization history and logs">
        <thead>
            <tr>
                <th>Started</th>
                <th>Completed</th>
                <th>Duration</th>
                <th>Status</th>
                <th>Events</th>
                <th>Errors</th>
            </tr>
        </thead>
        <tbody>
            {% for log in sync_logs %}
            <tr>
                <td>{{ log.started_at|date:"M d, H:i:s" }}</td>
                <td>
                    {% if log.completed_at %}
                        {{ log.completed_at|date:"M d, H:i:s" }}
                    {% else %}
                        <span class="status status-pending">Running</span>
                    {% endif %}
                </td>
                <td>
                    {% if log.completed_at %}
                        {{ log.duration }} sec
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if log.success %}
                        <span class="status status-active">Success</span>
                    {% elif log.completed_at %}
                        <span class="status status-inactive">Failed</span>
                    {% else %}
                        <span class="status status-pending">Running</span>
                    {% endif %}
                </td>
                <td>
                    {% if log.events_processed %}
                        {{ log.events_processed }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if log.error_message %}
                        <span class="status status-inactive">{{ log.error_message|truncatechars:30 }}</span>
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- Actions -->
<div class="card" role="region" aria-labelledby="account-actions-heading">
    <h3 id="account-actions-heading">Account Actions</h3>
    <div class="actions-container">
        {% if account.is_active %}
            <button type="button" class="btn" disabled aria-describedby="manual-sync-help">Run Manual Sync</button>
            <span id="manual-sync-help" class="sr-only">Manual sync functionality coming soon</span>
            
            <a href="{% url 'dashboard:refresh_calendars' account.id %}" class="btn" aria-describedby="refresh-help">Refresh Calendars</a>
            <span id="refresh-help" class="sr-only">Update calendar list from Google</span>
            
            <button type="button" class="btn btn-danger" disabled aria-describedby="disconnect-help">Disconnect Account</button>
            <span id="disconnect-help" class="sr-only">Account disconnection functionality coming soon</span>
        {% else %}
            <button type="button" class="btn btn-success" disabled aria-describedby="reactivate-help">Reactivate Account</button>
            <span id="reactivate-help" class="sr-only">Account reactivation functionality coming soon</span>
            
            <button type="button" class="btn btn-danger" disabled aria-describedby="remove-help">Remove Account</button>
            <span id="remove-help" class="sr-only">Account removal functionality coming soon</span>
        {% endif %}
    </div>
</div>
{% endblock %}