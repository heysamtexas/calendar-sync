<div id="calendar-{{ calendar.id }}-status" 
     class="d-flex flex-column align-items-center" 
     role="region" 
     aria-label="Sync settings for {{ calendar.name }}">
     
    <form method="post">
        {% csrf_token %}
        
        <div class="d-flex flex-column align-items-center gap-2">
            <div class="form-check form-switch">
                <input class="form-check-input" 
                       type="checkbox" 
                       role="switch"
                       id="sync-toggle-{{ calendar.id }}"
                       name="sync_enabled"
                       {% if calendar.sync_enabled %}checked{% endif %}
                       {% if calendar.cleanup_pending %}disabled{% endif %}
                       hx-post="{% url 'dashboard:toggle_calendar_sync' calendar.id %}"
                       hx-target="closest td"
                       hx-swap="innerHTML"
                       hx-indicator="#loading-{{ calendar.id }}"
                       aria-label="{% if calendar.cleanup_pending %}Sync disabled - cleanup in progress (cannot change){% elif calendar.sync_enabled %}Disable{% else %}Enable{% endif %} sync for {{ calendar.name }}">
                <label class="form-check-label visually-hidden" for="sync-toggle-{{ calendar.id }}">
                    Toggle sync for {{ calendar.name }}
                </label>
            </div>
            
            <span id="sync-status-{{ calendar.id }}" 
                  class="text-center small"
                  aria-live="polite">
                {% if calendar.cleanup_pending %}
                    <span class="text-warning">
                        Sync disabled - cleanup in progress
                        <br><small class="text-muted">(usually takes 1-2 minutes)</small>
                    </span>
                {% elif calendar.sync_enabled %}
                    <span class="text-success fw-medium">Enabled</span>
                {% else %}
                    <span class="text-muted">Disabled</span>
                {% endif %}
            </span>
        </div>
        
        <!-- Loading indicator -->
        <div id="loading-{{ calendar.id }}" 
             class="d-none align-items-center gap-2 text-muted small mt-2 htmx-indicator"
             role="status"
             aria-label="Updating sync settings">
            <div class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></div>
            <span>Updating...</span>
        </div>
        
        <!-- Error container -->
        <div id="error-{{ calendar.id }}" 
             class="mt-2"
             role="alert"
             aria-live="assertive"
             style="display: none;">
        </div>
    </form>
</div>