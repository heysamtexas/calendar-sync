{% extends "base.html" %}

{% block title %}Dashboard - Calendar Sync Tool{% endblock %}

{% block content %}
<div class="card">
    <h2>Dashboard</h2>
    <p>Manage your calendar synchronization settings and monitor sync status.</p>
</div>

<!-- Quick Stats -->
<div class="card" role="region" aria-labelledby="stats-heading">
    <h3 id="stats-heading">Quick Stats</h3>
    <table role="table" aria-label="Calendar synchronization statistics">
        <tr>
            <td><strong>Connected Accounts:</strong></td>
            <td>{{ calendar_accounts.count }}</td>
        </tr>
        <tr>
            <td><strong>Active Accounts:</strong></td>
            <td>{{ active_accounts }}</td>
        </tr>
        <tr>
            <td><strong>Total Calendars:</strong></td>
            <td>{{ total_calendars }}</td>
        </tr>
        <tr>
            <td><strong>Sync Status:</strong></td>
            <td>
                {% if sync_enabled %}
                    <span class="status status-active">Enabled</span>
                {% else %}
                    <span class="status status-inactive">Disabled</span>
                {% endif %}
            </td>
        </tr>
    </table>
</div>

<!-- Connected Accounts -->
<div class="card" role="region" aria-labelledby="accounts-heading">
    <h3 id="accounts-heading">Connected Accounts</h3>
    {% if calendar_accounts %}
        <table role="table" aria-label="Connected Google Calendar accounts">
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Calendars</th>
                    <th>Last Sync</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for account in calendar_accounts %}
                <tr>
                    <td>{{ account.email }}</td>
                    <td>
                        {% if account.is_active %}
                            <span class="status status-active">Active</span>
                        {% else %}
                            <span class="status status-inactive">Inactive</span>
                        {% endif %}
                    </td>
                    <td>{{ account.calendars.count }}</td>
                    <td>
                        {% if account.last_sync %}
                            {{ account.last_sync|date:"M d, Y H:i" }}
                        {% else %}
                            Never
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'dashboard:account_detail' account.id %}" class="btn" aria-label="View details for {{ account.email }}">View Details</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No calendar accounts connected yet.</p>
        <a href="{% url 'accounts:connect' %}" class="btn btn-success">Connect Your First Calendar</a>
    {% endif %}
</div>

<!-- Recent Sync Activity -->
{% if recent_syncs %}
<div class="card" role="region" aria-labelledby="sync-activity-heading">
    <h3 id="sync-activity-heading">Recent Sync Activity</h3>
    <table role="table" aria-label="Recent calendar synchronization activity">
        <thead>
            <tr>
                <th>Account</th>
                <th>Started</th>
                <th>Duration</th>
                <th>Status</th>
                <th>Events</th>
            </tr>
        </thead>
        <tbody>
            {% for sync in recent_syncs %}
            <tr>
                <td>{{ sync.calendar_account.email }}</td>
                <td>{{ sync.started_at|date:"M d, H:i" }}</td>
                <td>
                    {% if sync.completed_at %}
                        {{ sync.duration }} sec
                    {% else %}
                        <span class="status status-pending">Running</span>
                    {% endif %}
                </td>
                <td>
                    {% if sync.success %}
                        <span class="status status-active">Success</span>
                    {% elif sync.completed_at %}
                        <span class="status status-inactive">Failed</span>
                    {% else %}
                        <span class="status status-pending">Running</span>
                    {% endif %}
                </td>
                <td>
                    {% if sync.events_processed %}
                        {{ sync.events_processed }}
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- Actions -->
<div class="card" role="region" aria-labelledby="actions-heading">
    <h3 id="actions-heading">Available Actions</h3>
    <div class="actions-container">
        <a href="{% url 'accounts:connect' %}" class="btn btn-success" aria-describedby="connect-help">Connect New Account</a>
        <span id="connect-help" class="sr-only">Add a new Google Calendar account to sync</span>
        {% if calendar_accounts %}
            <button type="button" class="btn" disabled aria-describedby="sync-help">Run Manual Sync</button>
            <span id="sync-help" class="sr-only">Manual sync functionality coming soon</span>
        {% endif %}
    </div>
</div>
{% endblock %}