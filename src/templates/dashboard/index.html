{% extends "base.html" %}

{% block title %}Dashboard - Calendar Sync Tool{% endblock %}

{% block content %}
<div class="card">
    <h2>Dashboard</h2>
    <p>Manage your calendar synchronization settings and monitor sync status.</p>
</div>

<!-- Quick Stats -->
<div class="card">
    <h3>Quick Stats</h3>
    <table>
        <tr>
            <td><strong>Connected Accounts:</strong></td>
            <td>{{ calendar_accounts.count }}</td>
        </tr>
        <tr>
            <td><strong>Active Accounts:</strong></td>
            <td>{{ active_accounts }}</td>
        </tr>
        <tr>
            <td><strong>Total Calendars:</strong></td>
            <td>{{ total_calendars }}</td>
        </tr>
        <tr>
            <td><strong>Sync Status:</strong></td>
            <td>
                {% if sync_enabled %}
                    <span class="status status-active">Enabled</span>
                {% else %}
                    <span class="status status-inactive">Disabled</span>
                {% endif %}
            </td>
        </tr>
    </table>
</div>

<!-- Connected Accounts -->
<div class="card">
    <h3>Connected Accounts</h3>
    {% if calendar_accounts %}
        <table>
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Calendars</th>
                    <th>Last Sync</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for account in calendar_accounts %}
                <tr>
                    <td>{{ account.email }}</td>
                    <td>
                        {% if account.is_active %}
                            <span class="status status-active">Active</span>
                        {% else %}
                            <span class="status status-inactive">Inactive</span>
                        {% endif %}
                    </td>
                    <td>{{ account.calendars.count }}</td>
                    <td>
                        {% if account.last_sync %}
                            {{ account.last_sync|date:"M d, Y H:i" }}
                        {% else %}
                            Never
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'dashboard:account_detail' account.id %}" class="btn">View Details</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No calendar accounts connected yet.</p>
        <a href="{% url 'accounts:connect' %}" class="btn btn-success">Connect Your First Calendar</a>
    {% endif %}
</div>

<!-- Recent Sync Activity -->
{% if recent_syncs %}
<div class="card">
    <h3>Recent Sync Activity</h3>
    <table>
        <thead>
            <tr>
                <th>Account</th>
                <th>Started</th>
                <th>Duration</th>
                <th>Status</th>
                <th>Events</th>
            </tr>
        </thead>
        <tbody>
            {% for sync in recent_syncs %}
            <tr>
                <td>{{ sync.calendar_account.email }}</td>
                <td>{{ sync.started_at|date:"M d, H:i" }}</td>
                <td>
                    {% if sync.completed_at %}
                        {{ sync.duration }} sec
                    {% else %}
                        <span class="status status-pending">Running</span>
                    {% endif %}
                </td>
                <td>
                    {% if sync.success %}
                        <span class="status status-active">Success</span>
                    {% elif sync.completed_at %}
                        <span class="status status-inactive">Failed</span>
                    {% else %}
                        <span class="status status-pending">Running</span>
                    {% endif %}
                </td>
                <td>
                    {% if sync.events_processed %}
                        {{ sync.events_processed }}
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- Actions -->
<div class="card">
    <h3>Actions</h3>
    <a href="{% url 'accounts:connect' %}" class="btn btn-success">Connect New Account</a>
    {% if calendar_accounts %}
        <a href="#" class="btn">Run Manual Sync</a>
    {% endif %}
</div>
{% endblock %}